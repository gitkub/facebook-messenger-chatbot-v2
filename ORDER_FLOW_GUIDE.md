# ЁЯЫТ р╕Др╕╣р╣Ир╕бр╕╖р╕н Flow р╕Бр╕▓р╕гр╕кр╕▒р╣Ир╕Зр╕Лр╕╖р╣Йр╕нр╕Вр╕нр╕З Chatbot

## ЁЯУЛ Flow р╕Бр╕▓р╕гр╕кр╕▒р╣Ир╕Зр╕Лр╕╖р╣Йр╕нр╣Бр╕Ър╕Ър╕кр╕бр╕Ър╕╣р╕гр╕Ур╣М

### ЁЯФД **Flow р╣Бр╕Ър╕Ър╣Вр╕нр╕Щр╣Ар╕Зр╕┤р╕Щ**

1. **р╕ер╕╣р╕Бр╕Др╣Йр╕▓р╕кр╕▒р╣Ир╕Зр╕Лр╕╖р╣Йр╕н** тЖТ `order_confirm`
   ```
   ЁЯСд "р╣Ар╕нр╕▓р╕кр╕╡р╕Фр╕│ L 2 р╕Хр╕▒р╕зр╕Др╣Ир╕░"
   ЁЯдЦ "р╕Др╕╕р╕Ур╕кр╕░р╕Фр╕зр╕Бр╕Кр╕│р╕гр╕░р╣Ар╕Зр╕┤р╕Щр╣Бр╕Ър╕Ър╣Др╕лр╕Щр╕Др╕░?"
   ```

2. **р╣Ар╕ер╕╖р╕нр╕Бр╣Вр╕нр╕Щр╣Ар╕Зр╕┤р╕Щ** тЖТ `payment_transfer`
   ```
   ЁЯСд "р╣Вр╕нр╕Щр╕Др╣Ир╕░"
   ЁЯдЦ р╕кр╣Ир╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Ър╕▒р╕Нр╕Кр╕╡ + "р╕гр╕нр╕кр╕ер╕┤р╕Ыр╕Др╣Ир╕░"
   ```

3. **р╕кр╣Ир╕Зр╕кр╕ер╕┤р╕Ы** тЖТ `slip_received`
   ```
   ЁЯСд "р╕кр╣Ир╕Зр╕кр╕ер╕┤р╕Ыр╣Бр╕ер╣Йр╕зр╕Др╣Ир╕░"
   ЁЯдЦ "р╣Др╕Фр╣Йр╕гр╕▒р╕Ър╕кр╕ер╕┤р╕Ыр╣Бр╕ер╣Йр╕з р╕Вр╕нр╕Чр╕╡р╣Ир╕нр╕вр╕╣р╣Ир╕Ир╕▒р╕Фр╕кр╣Ир╕Зр╕Др╣Ир╕░"
   ```

4. **р╕кр╣Ир╕Зр╕Чр╕╡р╣Ир╕нр╕вр╕╣р╣И** тЖТ `address_received`
   ```
   ЁЯСд [р╕кр╣Ир╕Зр╕Чр╕╡р╣Ир╕нр╕вр╕╣р╣И]
   ЁЯдЦ "р╕Вр╕нр╕Ър╕Др╕╕р╕У р╕Ир╕░р╕Ир╕▒р╕Фр╕кр╣Ир╕Зр╣Гр╕Щ 1-2 р╕зр╕▒р╕Щ"
   ```

### ЁЯЪЪ **Flow р╣Бр╕Ър╕Ър╣Ар╕Бр╣Зр╕Ър╕Ыр╕ер╕▓р╕вр╕Чр╕▓р╕З**

1. **р╕ер╕╣р╕Бр╕Др╣Йр╕▓р╕кр╕▒р╣Ир╕Зр╕Лр╕╖р╣Йр╕н** тЖТ `order_confirm`
   ```
   ЁЯСд "р╣Ар╕нр╕▓р╕кр╕╡р╕Вр╕▓р╕з M 1 р╕Хр╕▒р╕зр╕Др╣Ир╕░"
   ЁЯдЦ "р╕Др╕╕р╕Ур╕кр╕░р╕Фр╕зр╕Бр╕Кр╕│р╕гр╕░р╣Ар╕Зр╕┤р╕Щр╣Бр╕Ър╕Ър╣Др╕лр╕Щр╕Др╕░?"
   ```

2. **р╣Ар╕ер╕╖р╕нр╕Бр╣Ар╕Бр╣Зр╕Ър╕Ыр╕ер╕▓р╕вр╕Чр╕▓р╕З** тЖТ `payment_cod`
   ```
   ЁЯСд "р╣Ар╕Бр╣Зр╕Ър╕Ыр╕ер╕▓р╕вр╕Чр╕▓р╕Зр╕Др╣Ир╕░"
   ЁЯдЦ "р╕гр╕▒р╕Ър╕Чр╕гр╕▓р╕Ъ р╕Бр╕гр╕╕р╕Ур╕▓р╕кр╣Ир╕Зр╕Чр╕╡р╣Ир╕нр╕вр╕╣р╣Ир╕Ир╕▒р╕Фр╕кр╣Ир╕Зр╕Др╣Ир╕░"
   ```

3. **р╕кр╣Ир╕Зр╕Чр╕╡р╣Ир╕нр╕вр╕╣р╣И** тЖТ `address_received`
   ```
   ЁЯСд [р╕кр╣Ир╕Зр╕Чр╕╡р╣Ир╕нр╕вр╕╣р╣И]
   ЁЯдЦ "р╕Вр╕нр╕Ър╕Др╕╕р╕У р╕Ир╕░р╕Ир╕▒р╕Фр╕кр╣Ир╕Зр╣Гр╕Щ 1-2 р╕зр╕▒р╕Щ"
   ```

## ЁЯОп Intent р╕Чр╕╡р╣Ир╣Ар╕Бр╕╡р╣Ир╕вр╕зр╕Вр╣Йр╕нр╕Зр╕Бр╕▒р╕Ър╕Бр╕▓р╕гр╕кр╕▒р╣Ир╕Зр╕Лр╕╖р╣Йр╕н

| Intent | р╣Ар╕бр╕╖р╣Ир╕нр╣Др╕лр╕гр╣И | р╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕З |
|--------|----------|----------|
| `order_confirm` | р╣Бр╕Ир╣Йр╕Зр╕гр╕▓р╕вр╕Бр╕▓р╕гр╕кр╕▒р╣Ир╕Зр╕Лр╕╖р╣Йр╕нр╕Кр╕▒р╕Фр╣Ар╕Ир╕Щ | "р╣Ар╕нр╕▓р╕кр╕╡р╕Фр╕│ L 2 р╕Хр╕▒р╕з" |
| `payment_transfer` | р╣Ар╕ер╕╖р╕нр╕Бр╣Вр╕нр╕Щр╣Ар╕Зр╕┤р╕Щ | "р╣Вр╕нр╕Щр╕Др╣Ир╕░", "PromptPay" |
| `payment_cod` | р╣Ар╕ер╕╖р╕нр╕Бр╣Ар╕Бр╣Зр╕Ър╕Ыр╕ер╕▓р╕вр╕Чр╕▓р╕З | "р╣Ар╕Бр╣Зр╕Ър╕Ыр╕ер╕▓р╕вр╕Чр╕▓р╕Зр╕Др╣Ир╕░" |
| `slip_received` | р╕кр╣Ир╕Зр╕кр╕ер╕┤р╕Ыр╕бр╕▓ | "р╕кр╣Ир╕Зр╕кр╕ер╕┤р╕Ыр╣Бр╕ер╣Йр╕з" |
| `address_received` | р╕кр╣Ир╕Зр╕Чр╕╡р╣Ир╕нр╕вр╕╣р╣Ир╕бр╕▓ | [р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Чр╕╡р╣Ир╕нр╕вр╕╣р╣И] |

## тЪЩя╕П р╕Бр╕▓р╕гр╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Шр╕Щр╕▓р╕Др╕▓р╕г

р╣Бр╕Бр╣Йр╣Др╕Вр╣Др╕Яр╕ер╣М `business_context.json` р╕кр╣Ир╕зр╕Щ `bank_account`:

```json
"bank_account": {
  "bank_name": "р╕Шр╕Щр╕▓р╕Др╕▓р╕гр╕Бр╕кр╕┤р╕Бр╕гр╣Др╕Чр╕в",
  "account_name": "р╕Щр╕▓р╕Зр╕кр╕▓р╕з/р╕Щр╕▓р╕в [р╕Кр╕╖р╣Ир╕нр╕Ир╕гр╕┤р╕Зр╕Вр╕нр╕Зр╕Др╕╕р╕У]",
  "account_number": "[р╣Ар╕ер╕Вр╕Ър╕▒р╕Нр╕Кр╕╡р╕Вр╕нр╕Зр╕Др╕╕р╕У]",
  "promptpay": "[р╣Ар╕Ър╕нр╕гр╣Мр╣Вр╕Чр╕г PromptPay р╕Вр╕нр╕Зр╕Др╕╕р╕У]"
}
```

## ЁЯФз р╕Бр╕▓р╕гр╕Ыр╕гр╕▒р╕Ър╣Бр╕Хр╣Ир╕Зр╕Вр╣Йр╕нр╕Др╕зр╕▓р╕б

### р╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╣Вр╕нр╕Щр╣Ар╕Зр╕┤р╕Щ
р╣Бр╕Бр╣Йр╣Др╕Вр╣Гр╕Щ `replies.json` тЖТ `payment_transfer`:
```json
"reply": "ЁЯТ│ р╣Вр╕нр╕Щр╣Ар╕Зр╕┤р╕Щр╕бр╕▓р╕Чр╕╡р╣И:\n\nЁЯПж р╕Шр╕Щр╕▓р╕Др╕▓р╕г...\n..."
```

### р╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╣Ар╕Бр╣Зр╕Ър╕Ыр╕ер╕▓р╕вр╕Чр╕▓р╕З
р╣Бр╕Бр╣Йр╣Др╕Вр╣Гр╕Щ `replies.json` тЖТ `payment_cod`:
```json
"reply": "тЬЕ р╣Ар╕Бр╣Зр╕Ър╣Ар╕Зр╕┤р╕Щр╕Ыр╕ер╕▓р╕вр╕Чр╕▓р╕З р╕гр╕▒р╕Ър╕Чр╕гр╕▓р╕Ър╕Др╣Ир╕░\n..."
```

## ЁЯУЭ р╕лр╕бр╕▓р╕вр╣Ар╕лр╕Хр╕╕

- р╕гр╕░р╕Ър╕Ър╕Ир╕░ detect intent р╕нр╕▒р╕Хр╣Вр╕Щр╕бр╕▒р╕Хр╕┤р╕Хр╕▓р╕бр╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╕ер╕╣р╕Бр╕Др╣Йр╕▓
- р╣Бр╕Хр╣Ир╕ер╕░ intent р╕Ир╕░р╕бр╕╡р╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╕Хр╕нр╕Ър╕Бр╕ер╕▒р╕Ър╕Чр╕╡р╣Ир╣Ар╕лр╕бр╕▓р╕░р╕кр╕б
- р╕кр╕▓р╕бр╕▓р╕гр╕Цр╕Ыр╕гр╕▒р╕Ър╣Бр╕Хр╣Ир╕Зр╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╣Др╕Фр╣Йр╕Хр╕▓р╕бр╕кр╣Др╕Хр╕ер╣Мр╕Вр╕нр╕Зр╕гр╣Йр╕▓р╕Щ
- р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Шр╕Щр╕▓р╕Др╕▓р╕гр╕Ир╕░р╣Бр╕кр╕Фр╕Зр╣Гр╕Щр╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╣Вр╕нр╕Щр╣Ар╕Зр╕┤р╕Щ